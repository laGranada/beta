<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      href="https://www.w3schools.com/w3css/4/w3.css">

    <!-- will center the website on screens that are wider than 800px -->
    <style>
        body{
            background: #E6E6FA;
        }
        .content {
            max-width: 1700px;
            margin: auto;
        }
        .ui-dialog.ui-widget-content{
            background-color: #E6E6FA;
        }
    </style>

    <h:head>
        <title>Contacts</title>
        <!-- LINK FOR ICONS -->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    </h:head>   


    <!-- ========================================================================= -->
    <!-- =======================         BODY           ========================== -->
    <!-- ========================================================================= -->
    <h:body>
        <div class="content">
            <h1 algin="center">
                Contactinformations
            </h1>

            <!-- LINK TO CONTACT SECTION -->
            <h:link target="_blank" rel="noopener noreferrer" outcome="contactSection" value="Contact us" /> <br />

            <h3 align="left" style="color: purple">
                by Maggie<i class="fa fa-trash"></i>
            </h3>

            <h:form id="form" >  
                <!-- =======================      DELETE LINK       ========================== -->
                <p:commandLink style="float: right"  >
                    <i class="material-icons" style="font-size:36px;color:purple">delete</i>
                    <p:ajax event="click" listener="#{editView.deleteNodes(editView.selectedNodes)}"  update="ttId" /> 
                </p:commandLink>

                <!-- USED TO DISPLAY FACESMESSAGES -->
                <p:growl id="msgs" showDetail="true"/>             

                <!-- ========================================================================= -->
                <!-- =======================       TREETABLE        ========================== -->
                <!-- ========================================================================= -->
                <p:treeTable  style="width:1700px" resizableColumns="true" value="#{contactService.root}" var="contact" editable="true" 
                              nodeVar="node" id="ttId" selectionMode="checkbox" selection="#{editView.selectedNodes}" 
                              paginator="true" rows="10">

                    <f:facet name="header">
                        Contacts
                    </f:facet>   

                    <!-- =======================     ROWEDIT EVENTS     ========================== -->
                    <p:ajax event="rowEdit" listener="#{editView.onRowEdit}" update=":form:msgs"/>
                    <p:ajax event="rowEditCancel" listener="#{editView.onRowCancel}" update=":form:msgs" />


                    <!-- =======================    FIRST NAME    ========================== -->
                    <p:column  headerText="First name">
                        <p:treeNode type="contact" rendered="#{node.type == 'contact'}">
                            <p:cellEditor>                           
                                <f:facet name="output"><h:outputText value="#{contact.firstName}" /></f:facet>
                                <f:facet name="input"><p:inputText value="#{contact.firstName}" style="width:100%"/></f:facet>
                            </p:cellEditor>
                        </p:treeNode> 
                        <!-- =======================      DESCRIPTION       ========================== -->
                        <p:treeNode type="description" rendered="#{node.type == 'description'}">
                            <h:outputText value="#{contact}"></h:outputText>
                        </p:treeNode>
                    </p:column>
                    <!-- =======================       LAST NAME        ========================== -->
                    <p:column   headerText="Last name">
                        <p:treeNode type="contact" rendered="#{node.type == 'contact'}">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{contact.lastName}" /></f:facet>
                                <f:facet name="input"><p:inputText value="#{contact.lastName}"/></f:facet>
                            </p:cellEditor>
                        </p:treeNode>     
                    </p:column>
                    <!-- =======================     COMMUNICATION      ========================== -->
                    <p:column  headerText="Communication" style="width:180px">
                        <p:treeNode type="communication" rendered="#{node.type == 'communication'}">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{contact.identifier}" /></f:facet>
                                <f:facet name="input"><p:inputText value="#{contact.identifier}" style="width:95%" /></f:facet>
                            </p:cellEditor>
                        </p:treeNode>    
                    </p:column>
                    <!-- =======================     TYPE DROPDOWN      ========================== -->
                    <p:column headerText="Type" style="width:100px">
                        <p:treeNode type="communication" rendered="#{node.type == 'communication'}">
                            <p:cellEditor>                           
                                <f:facet name="output"><h:outputText value="#{contact.type}" /></f:facet>
                                <f:facet name="input">
                                    <h:selectOneMenu value="#{contact.type}" style="width:100%">
                                        <f:selectItems value="#{contactService.type}" var="type" itemLabel="#{type}" itemValue="#{type}" />
                                    </h:selectOneMenu>
                                </f:facet>                          
                            </p:cellEditor>
                        </p:treeNode>
                    </p:column>
                    <!-- =======================         STREET         ========================== -->
                    <p:column  headerText="Street">
                        <p:treeNode type="address" rendered="#{node.type == 'address'}">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{contact.street}" /></f:facet>
                                <f:facet name="input"><p:inputText value="#{contact.street}" style="width:95%"/></f:facet>
                            </p:cellEditor>
                        </p:treeNode>
                    </p:column>
                    <!-- =======================        ZIP CODE        ========================== -->
                    <p:column  headerText="Zip code" style="width:150px">
                        <p:treeNode type="address" rendered="#{node.type == 'address'}">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{contact.zipCode}" /></f:facet>
                                <f:facet name="input"><p:inputText value="#{contact.zipCode}" style="width:95%"/></f:facet>
                            </p:cellEditor>
                        </p:treeNode>
                    </p:column>
                    <!-- =======================    COUNTRY DROPDOWN    ========================== -->
                    <p:column headerText="Country" style="width:120px">
                        <p:treeNode type="address" rendered="#{node.type == 'address'}">
                            <p:cellEditor>                           
                                <f:facet name="output"><h:outputText value="#{contact.country}" /></f:facet>
                                <f:facet name="input">
                                    <h:selectOneMenu value="#{contact.country}" style="width:100%">
                                        <f:selectItems value="#{contactService.countries}" var="type" itemLabel="#{country}" itemValue="#{country}" />
                                    </h:selectOneMenu>
                                </f:facet>                          
                            </p:cellEditor>
                        </p:treeNode>
                    </p:column>
                    <!-- =======================EDIT LINK AND ROWEDITOR ========================== -->
                    <p:column headerText="Edit" style="width:40px">
                        <!-- EDIT LINK -->
                        <p:treeNode type="contact" rendered="#{node.type == 'contact'}">                           
                            <p:commandLink process="@this" onclick="PF('dlg').show()" update="@form:dlgPanel">
                                <i class="material-icons" style="font-size:15px;color:purple">edit</i>
                                <f:setPropertyActionListener value="#{contact}" target="#{editView.selectedContact}"/>
                            </p:commandLink>
                        </p:treeNode>  
                        <!-- COMMUNICATION ROWEDITOR -->
                        <p:treeNode type="communication" rendered="#{node.type == 'communication'}">
                            <p:rowEditor />
                        </p:treeNode>  
                        <!-- ADDRESS ROWEDITOR -->
                        <p:treeNode type="address" rendered="#{node.type == 'address'}">
                            <p:rowEditor />
                        </p:treeNode>  
                    </p:column> 
                </p:treeTable>  

                <!-- ========================================================================= -->
                <!-- =======================    EDIT NAME DIALOG    ========================== -->
                <!-- ========================================================================= -->
                <p:dialog id="dialog" header="Edit" widgetVar="dlg" showEffect="fade" modal="true" resizable="false">
                    <h:panelGrid id="dlgPanel" columns="1" >
                        <!-- FIRST NAME -->
                        <h:outputLabel value="First Name: "/> 
                        <!-- rendered damit er es nur anzeigt wenn editView.selectedContact.firstName != null ist-->
                        <p:inputText rendered="#{editView.selectedContact != null}" value="#{editView.selectedContact.firstName}"/>
                        <!-- LAST NAME -->
                        <h:outputLabel value="Last Name: "/>
                        <p:inputText rendered="#{editView.selectedContact != null}" value="#{editView.selectedContact.lastName}"/>

                        <p:commandLink style="float: right" type="submit" update="@form:ttId" onclick="PF('dlg').hide()">
                            <i class="material-icons" style="font-size:40px;color:purple">save</i>
                        </p:commandLink>
                    </h:panelGrid>                    
                </p:dialog>                
            </h:form>
        </div>
    </h:body>
</html>
